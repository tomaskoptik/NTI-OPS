#include "mbed.h"
#include "stm32746g_discovery_lcd.h"

DigitalOut myLed(LED1);
Mutex mutex;

void lcd_init() {
    BSP_LCD_Init();
    BSP_LCD_LayerDefaultInit(LTDC_ACTIVE_LAYER, LCD_FB_START_ADDRESS);
    BSP_LCD_SelectLayer(LTDC_ACTIVE_LAYER);
    BSP_LCD_Clear(LCD_COLOR_BLACK);
}

void car_black() {
    while (true) {
        mutex.lock();
        BSP_LCD_SetFont(&LCD_DEFAULT_FONT);
        BSP_LCD_SetBackColor(LCD_COLOR_WHITE);
        BSP_LCD_SetTextColor(LCD_COLOR_DARKBLUE);
        BSP_LCD_DisplayStringAt(0, 0, (uint8_t *)"CAR1", CENTER_MODE);
        mutex.unlock();

        ThisThread::sleep_for(5000ms);

        mutex.lock();
        BSP_LCD_SetTextColor(LCD_COLOR_BLACK);
        BSP_LCD_FillRect(0, 0, 400, 30); 
        mutex.unlock();

        ThisThread::sleep_for(5000ms); 
}
}

void car_green() {
    while (true) {
        mutex.lock();
        BSP_LCD_SetFont(&LCD_DEFAULT_FONT);
        BSP_LCD_SetBackColor(LCD_COLOR_GREEN);
        BSP_LCD_SetTextColor(LCD_COLOR_BLACK);
        BSP_LCD_DisplayStringAt(0, 30, (uint8_t *)"CAR2", CENTER_MODE);
        mutex.unlock();

        ThisThread::sleep_for(3000ms); 

        mutex.lock();
        BSP_LCD_SetTextColor(LCD_COLOR_BLACK);
        BSP_LCD_FillRect(0, 30, 400, 60); 
        mutex.unlock();

        ThisThread::sleep_for(7000ms);
    }
}


int main() {
    lcd_init();

    Thread car1_thread;
    Thread car2_thread;
    car1_thread.start(car_black);
    car2_thread.start(car_green);

    while (true) {
    }
}
