#include "mbed.h"
#include "stm32746g_discovery_lcd.h"

DigitalOut myLed(LED1);

class Semafor {
public:
    Semafor(int count = 1) : slot(count) {}

    void acquire() {
        slot.acquire();
    }

    void release() {
        slot.release();
    }

private:
    Semaphore slot;
};

Semafor parkoviste(1); 

void car_function(const char *car_name) {
    while (true) {
        parkoviste.acquire();

        BSP_LCD_SetFont(&LCD_DEFAULT_FONT);
        BSP_LCD_SetBackColor(LCD_COLOR_WHITE);
        BSP_LCD_SetTextColor(LCD_COLOR_DARKBLUE);
        BSP_LCD_DisplayStringAt(0, LINE(5), (uint8_t *)car_name, CENTER_MODE);

        ThisThread::sleep_for(3000ms);


        BSP_LCD_Clear(LCD_COLOR_BLACK);

        parkoviste.release();

        ThisThread::sleep_for(2000ms);
    }
}

int main() {
    Thread car1_thread;
    Thread car2_thread;

    BSP_LCD_Init();
    BSP_LCD_LayerDefaultInit(LTDC_ACTIVE_LAYER, LCD_FB_START_ADDRESS);
    BSP_LCD_SelectLayer(LTDC_ACTIVE_LAYER);
    BSP_LCD_Clear(LCD_COLOR_BLACK);

    car1_thread.start(callback(car_function, "CAR 1"));
    car2_thread.start(callback(car_function, "CAR 2"));

    while (true) {
    }
}
